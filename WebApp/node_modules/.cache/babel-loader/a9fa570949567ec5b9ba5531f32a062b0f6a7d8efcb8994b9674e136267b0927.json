{"ast":null,"code":"'use strict';\n\n/**\n * Module dependencies\n */\nvar xtend = require('xtend');\nvar Readable = require('readable-stream').Readable;\nvar streamsOpts = {\n  objectMode: true\n};\nvar defaultStoreOptions = {\n  clean: true\n};\n\n/**\n * es6-map can preserve insertion order even if ES version is older.\n *\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map#Description\n * It should be noted that a Map which is a map of an object, especially\n * a dictionary of dictionaries, will only map to the object's insertion\n * order. In ES2015 this is ordered for objects but for older versions of\n * ES, this may be random and not ordered.\n *\n */\nvar Map = require('es6-map');\n\n/**\n * In-memory implementation of the message store\n * This can actually be saved into files.\n *\n * @param {Object} [options] - store options\n */\nfunction Store(options) {\n  if (!(this instanceof Store)) {\n    return new Store(options);\n  }\n  this.options = options || {};\n\n  // Defaults\n  this.options = xtend(defaultStoreOptions, options);\n  this._inflights = new Map();\n}\n\n/**\n * Adds a packet to the store, a packet is\n * anything that has a messageId property.\n *\n */\nStore.prototype.put = function (packet, cb) {\n  this._inflights.set(packet.messageId, packet);\n  if (cb) {\n    cb();\n  }\n  return this;\n};\n\n/**\n * Creates a stream with all the packets in the store\n *\n */\nStore.prototype.createStream = function () {\n  var stream = new Readable(streamsOpts);\n  var destroyed = false;\n  var values = [];\n  var i = 0;\n  this._inflights.forEach(function (value, key) {\n    values.push(value);\n  });\n  stream._read = function () {\n    if (!destroyed && i < values.length) {\n      this.push(values[i++]);\n    } else {\n      this.push(null);\n    }\n  };\n  stream.destroy = function () {\n    if (destroyed) {\n      return;\n    }\n    var self = this;\n    destroyed = true;\n    process.nextTick(function () {\n      self.emit('close');\n    });\n  };\n  return stream;\n};\n\n/**\n * deletes a packet from the store.\n */\nStore.prototype.del = function (packet, cb) {\n  packet = this._inflights.get(packet.messageId);\n  if (packet) {\n    this._inflights.delete(packet.messageId);\n    cb(null, packet);\n  } else if (cb) {\n    cb(new Error('missing packet'));\n  }\n  return this;\n};\n\n/**\n * get a packet from the store.\n */\nStore.prototype.get = function (packet, cb) {\n  packet = this._inflights.get(packet.messageId);\n  if (packet) {\n    cb(null, packet);\n  } else if (cb) {\n    cb(new Error('missing packet'));\n  }\n  return this;\n};\n\n/**\n * Close the store\n */\nStore.prototype.close = function (cb) {\n  if (this.options.clean) {\n    this._inflights = null;\n  }\n  if (cb) {\n    cb();\n  }\n};\nmodule.exports = Store;","map":{"version":3,"names":["xtend","require","Readable","streamsOpts","objectMode","defaultStoreOptions","clean","Map","Store","options","_inflights","prototype","put","packet","cb","set","messageId","createStream","stream","destroyed","values","i","forEach","value","key","push","_read","length","destroy","self","process","nextTick","emit","del","get","delete","Error","close","module","exports"],"sources":["/Users/thaitai/Desktop/Work/IoT/relay-web-app/node_modules/mqtt/lib/store.js"],"sourcesContent":["'use strict'\n\n/**\n * Module dependencies\n */\nvar xtend = require('xtend')\n\nvar Readable = require('readable-stream').Readable\nvar streamsOpts = { objectMode: true }\nvar defaultStoreOptions = {\n  clean: true\n}\n\n/**\n * es6-map can preserve insertion order even if ES version is older.\n *\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map#Description\n * It should be noted that a Map which is a map of an object, especially\n * a dictionary of dictionaries, will only map to the object's insertion\n * order. In ES2015 this is ordered for objects but for older versions of\n * ES, this may be random and not ordered.\n *\n */\nvar Map = require('es6-map')\n\n/**\n * In-memory implementation of the message store\n * This can actually be saved into files.\n *\n * @param {Object} [options] - store options\n */\nfunction Store (options) {\n  if (!(this instanceof Store)) {\n    return new Store(options)\n  }\n\n  this.options = options || {}\n\n  // Defaults\n  this.options = xtend(defaultStoreOptions, options)\n\n  this._inflights = new Map()\n}\n\n/**\n * Adds a packet to the store, a packet is\n * anything that has a messageId property.\n *\n */\nStore.prototype.put = function (packet, cb) {\n  this._inflights.set(packet.messageId, packet)\n\n  if (cb) {\n    cb()\n  }\n\n  return this\n}\n\n/**\n * Creates a stream with all the packets in the store\n *\n */\nStore.prototype.createStream = function () {\n  var stream = new Readable(streamsOpts)\n  var destroyed = false\n  var values = []\n  var i = 0\n\n  this._inflights.forEach(function (value, key) {\n    values.push(value)\n  })\n\n  stream._read = function () {\n    if (!destroyed && i < values.length) {\n      this.push(values[i++])\n    } else {\n      this.push(null)\n    }\n  }\n\n  stream.destroy = function () {\n    if (destroyed) {\n      return\n    }\n\n    var self = this\n\n    destroyed = true\n\n    process.nextTick(function () {\n      self.emit('close')\n    })\n  }\n\n  return stream\n}\n\n/**\n * deletes a packet from the store.\n */\nStore.prototype.del = function (packet, cb) {\n  packet = this._inflights.get(packet.messageId)\n  if (packet) {\n    this._inflights.delete(packet.messageId)\n    cb(null, packet)\n  } else if (cb) {\n    cb(new Error('missing packet'))\n  }\n\n  return this\n}\n\n/**\n * get a packet from the store.\n */\nStore.prototype.get = function (packet, cb) {\n  packet = this._inflights.get(packet.messageId)\n  if (packet) {\n    cb(null, packet)\n  } else if (cb) {\n    cb(new Error('missing packet'))\n  }\n\n  return this\n}\n\n/**\n * Close the store\n */\nStore.prototype.close = function (cb) {\n  if (this.options.clean) {\n    this._inflights = null\n  }\n  if (cb) {\n    cb()\n  }\n}\n\nmodule.exports = Store\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}